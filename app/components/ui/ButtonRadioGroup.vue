<template>
  <div role="group" :class="groupClasses">
    <label
      v-for="(option, index) in options"
      :key="index"
      :class="buttonClasses(option)"
    >
      <input type="radio" @click="select(option)" />
      {{ option[label] }}
    </label>
  </div>
</template>

<script>
import { eq } from "lodash";
import { hasOwn } from "sulcalc";

const sizeClasses = {
  small: "btn-group-sm",
  medium: "",
  large: "btn-group-lg"
};

const typeClasses = {
  primary: "-primary",
  secondary: "-secondary",
  success: "-success",
  danger: "-danger",
  warning: "-warning",
  info: "-info",
  light: "-light",
  dark: "-dark",
  link: "-link"
};

const noDefaultValue = { type: "ButtonRadioGroup/noDefaultValue" };

export default {
  props: {
    value: {
      type: null,
      default: null
    },
    options: {
      required: true,
      type: Array
    },
    defaultValue: {
      type: null,
      default: () => noDefaultValue
    },
    layout: {
      type: String,
      default: "horizontal",
      validator(value) {
        return value === "horizontal" || value === "vertical";
      }
    },
    size: {
      type: String,
      default: "medium",
      validator(value) {
        return hasOwn(sizeClasses, value);
      }
    },
    type: {
      type: String,
      default: "primary",
      validator(value) {
        return hasOwn(typeClasses, value);
      }
    },
    outline: {
      type: Boolean,
      default: false
    },
    label: {
      type: String,
      default: "label"
    },
    trackBy: {
      type: String,
      default: "value"
    }
  },
  computed: {
    groupClasses() {
      return {
        "btn-group": this.layout === "horizontal",
        "btn-group-toggle": true,
        "btn-group-vertical": this.layout === "vertical",
        [sizeClasses[this.size]]: true
      };
    }
  },
  methods: {
    select(option) {
      const value = option[this.trackBy];
      if (!eq(this.value, value)) {
        this.$emit("input", value);
      } else if (this.defaultValue !== noDefaultValue) {
        this.$emit("input", this.defaultValue);
      }
    },
    isSelected(option) {
      return eq(this.value, option[this.trackBy]);
    },
    buttonClasses(option) {
      const outline = this.outline ? "-outline" : "";
      return {
        btn: true,
        active: this.isSelected(option),
        [`btn${outline}${typeClasses[this.type]}`]: true,
        "clickable-control": true
      };
    }
  }
};
</script>

<style scoped>
.clickable-control {
  cursor: pointer;
  user-select: none;
}
</style>
